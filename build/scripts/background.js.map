{"version":3,"file":"scripts/background.js","mappings":"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","sources":["webpack://z2-blog-extension/./src/scripts/background.ts","webpack://z2-blog-extension/webpack/startup"],"sourcesContent":["\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\n/**\r\n * 获取当前tab页\r\n */\r\nvar getCurrentTab = function () { return __awaiter(void 0, void 0, void 0, function () {\r\n    var queryOptions, tab;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                queryOptions = { active: true, lastFocusedWindow: true };\r\n                return [4 /*yield*/, chrome.tabs.query(queryOptions)];\r\n            case 1:\r\n                tab = (_a.sent())[0];\r\n                return [2 /*return*/, tab];\r\n        }\r\n    });\r\n}); };\r\n// 弹出层是否已经打开\r\nvar isOpen = false;\r\n/**\r\n * 监听呼出弹出层快捷键\r\n */\r\nchrome.commands.onCommand.addListener(function (command) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var tab;\r\n    var _a;\r\n    return __generator(this, function (_b) {\r\n        switch (_b.label) {\r\n            case 0:\r\n                if (command !== 'write_note' || isOpen)\r\n                    return [2 /*return*/];\r\n                return [4 /*yield*/, getCurrentTab()];\r\n            case 1:\r\n                tab = _b.sent();\r\n                chrome.scripting.executeScript({\r\n                    target: { tabId: (_a = tab.id) !== null && _a !== void 0 ? _a : 0 },\r\n                    func: createPopupLayout,\r\n                }, function () {\r\n                    isOpen = true;\r\n                });\r\n                return [2 /*return*/];\r\n        }\r\n    });\r\n}); });\r\n/**\r\n * 监听关闭弹出层事件\r\n */\r\nchrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {\r\n    console.log(request === null || request === void 0 ? void 0 : request.code);\r\n    var code = request === null || request === void 0 ? void 0 : request.code;\r\n    if (!code)\r\n        return;\r\n    switch (code) {\r\n        case 'close-popup':\r\n            isOpen = false;\r\n            sendResponse({ msg: 'success' });\r\n            break;\r\n        case 'send-note':\r\n            console.log('发送！！');\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n});\r\n/**\r\n * 创建弹出层\r\n */\r\nvar createPopupLayout = function () {\r\n    // 插件id\r\n    var ID = 'ihidlmafkicdgplnabhallfbpfohojpo';\r\n    /**\r\n     * 转化node\r\n     */\r\n    var createNode = function (html, unuseFragment) {\r\n        var _a, _b;\r\n        if (!unuseFragment)\r\n            return document.createRange().createContextualFragment(html);\r\n        var doc = new DOMParser().parseFromString(html, 'text/html');\r\n        return ((_b = (_a = doc === null || doc === void 0 ? void 0 : doc.querySelector('body')) === null || _a === void 0 ? void 0 : _a.childNodes[0]) !== null && _b !== void 0 ? _b : null);\r\n    };\r\n    // dom\r\n    var body = document.querySelector('body');\r\n    var app = document.createElement('div');\r\n    var shadow = app.attachShadow({ mode: 'closed' });\r\n    // 样式\r\n    var stylesheet = chrome.runtime.getURL('../styles/style.css');\r\n    var styles = createNode(\"\\n        <link rel=\\\"stylesheet\\\" href=\\\"\".concat(stylesheet, \"\\\"></link>\\n    \"));\r\n    shadow.appendChild(styles);\r\n    // 遮罩\r\n    var mask = createNode(\"<div class=\\\"mask\\\"></div>\", true);\r\n    mask.addEventListener('click', function () {\r\n        body.removeChild(app);\r\n        chrome.runtime.sendMessage(ID, {\r\n            code: 'close-popup',\r\n        });\r\n    });\r\n    shadow.appendChild(mask);\r\n    // 弹出层\r\n    var popupLayout = createNode(\"<div class=\\\"popup-layout\\\"></div>\", true);\r\n    // 输入区域\r\n    var textarea = document.createElement('textarea');\r\n    textarea.setAttribute('class', 'textarea');\r\n    textarea.setAttribute('placeholder', '写下你的灵感');\r\n    textarea.setAttribute('spellcheck', 'false');\r\n    popupLayout.appendChild(textarea);\r\n    // 底部按钮栏\r\n    var bottomBar = createNode(\"<div class=\\\"bottom-bar\\\"></div>\", true);\r\n    popupLayout.appendChild(bottomBar);\r\n    // 发表按钮\r\n    var sendBtn = createNode(\"<button class=\\\"btn send-btn actived\\\">\\u53D1\\u8868</button>\", true);\r\n    bottomBar.appendChild(sendBtn);\r\n    sendBtn.addEventListener('click', function () {\r\n        var text = textarea.value;\r\n        console.log('textarea', text);\r\n        if (!text)\r\n            return;\r\n        chrome.runtime.sendMessage(ID, {\r\n            code: 'send-note',\r\n            content: text,\r\n        });\r\n    });\r\n    // 挂载\r\n    shadow.appendChild(popupLayout);\r\n    body.appendChild(app);\r\n};\r\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = {};\n__webpack_modules__[233]();\n"],"names":["__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","isOpen","chrome","commands","onCommand","addListener","command","tab","_a","_b","queryOptions","active","lastFocusedWindow","tabs","query","scripting","executeScript","target","tabId","id","func","createPopupLayout","runtime","onMessage","request","sender","sendResponse","console","log","code","msg","ID","createNode","html","unuseFragment","document","createRange","createContextualFragment","doc","DOMParser","parseFromString","querySelector","childNodes","app","createElement","shadow","attachShadow","mode","stylesheet","getURL","styles","concat","appendChild","mask","addEventListener","removeChild","sendMessage","popupLayout","textarea","setAttribute","bottomBar","sendBtn","text","content"],"sourceRoot":""}